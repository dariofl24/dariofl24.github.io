importScript("converse_core:common/libNamespace.ds");
importScript("converse_core:constants.ds");
importScript("int_cardinal:CardinalConstants.ds");

(function() {
    
    var CARDINAL = integration.cardinal;
    var CARDINAL_CONST = CARDINAL.constants.CardinalConstants;
    var PRODUCT_TYPE = converse.constants.ProductType;
    
    var FIRST_ORDER_FIELD_VALUES = {
        OrderNumber: "D511BD69-orig",       
        MerchantData: "",
        TransactionId: "pDOLDUV1sLvjKcHL6GHG",
        ReasonCode: "",
        ErrorDesc: "",
        ACSUrl: "https://centineltest.cardinalcommerce.com/maps/payment_pp_redirect.asp?payload=135%7C007964%7CpDOLDUV1sLvjKcHL6GHG%7CPP",
        OrderId: "8091443315938931",
        MerchantReferenceNumber: "",
        ErrorNo: "0",
        Payload: "135|007964|pDOLDUV1sLvjKcHL6GHG|PP",
        Enrolled: "Y",
        EciFlag: "",
        OrderNumber_1: "F511BD69-C0CD-45BA-A98B-A184A228EEC9",
        TransactionId_1: "0reh6oIy2fulztv851dd",
        OrderId_1: "8092362267450753",
        MerchantData_1: PRODUCT_TYPE.Regular
    };    
    
    var AUTHENTICATE_FIELD_VALUES = {
        PAResStatus : "Y",
        SignatureVerification: "Y",
        ProcessorUserStatus : "verified",
        ProcessorUserFirstName : "Test",
        ProcessorUserLastName : "User",
        ProcessorUserEmail : "mparis_1289313560_per@tacitknowledge.com",
        ProcessorShippingFullName : "Test User",
        ProcessorShippingAddress1 :  "1 Main St",
        ProcessorShippingAddress2 :  "",
        ProcessorShippingCity :  "San Jose",
        ProcessorShippingState :  "CA",
        ProcessorShippingPostalCode :  "95131",
        ProcessorShippingCountryCode :  "US",
        ProcessorShippingPhone  :  "159-562-7355",
        ProcessorBillingFullName :  "Test User",
        ProcessorBillingAddress1 :  "1 Main St",
        ProcessorBillingAddress2 :  "",
        ProcessorBillingCity :  "San Jose",
        ProcessorBillingState :  "CA",
        ProcessorBillingPostalCode :  "95131",
        ProcessorBillingCountryCode :  "US",
        ProcessorBillingPhone :  "159-562-6666",
        ProcessorShippingMethod :  "Air"
    };
     
    var VOID_FIELD_VALUES = {
        StatusCode : "Y",
        ReasonDesc : "",
        ReasonCode : "12345", 
        OrderId :"8091443315938931"
    };
    
    
    var COMPLEMENTARY_ORDER_FIELD_VALUES = {
        OrderNumber_2: "D511BD69-C0CD-45BA-A98B-A184A228EEC9",
        TransactionId_2: "0werfgIy2fulztv851dd",
        OrderId_2: "80923622674505",
        MerchantData_2: PRODUCT_TYPE.C1
    };
    
    var FAILED_ORDER_FIELD_VALUES = {
        ErrorDesc: CARDINAL_CONST.Messages.CommunicationErrorDesc,
        ErrorNo: CARDINAL_CONST.Messages.CommunicationErrorNo
    };
    
    var generateCentinelResponseXMLString = function(map) {
        var result = "";
        
        for (var key in map) {
            result += "<" + key + ">" + map[key] + "</" + key + ">";
        }
        
        return "<CardinalMPI>" + result + "</CardinalMPI>";
    };
    
    var mergeObjects = function(firstObject, secondObject) {
        var mergeResult = {};
        
        for (var field in secondObject) {
            mergeResult[field] = secondObject[field];
        }
        for (var field in firstObject) {
            mergeResult[field] = firstObject[field];
        }
        
        return mergeResult;
    };

    var TestCommandFactory = {
        getSuccessCommand: function() {
            return this.getCommand(true, generateCentinelResponseXMLString(FIRST_ORDER_FIELD_VALUES));
        },
        
        getFailedCommand: function() {
            return this.getCommand(false, generateCentinelResponseXMLString(FAILED_ORDER_FIELD_VALUES));
        },
        
        getCommand: function(failed, commandResponse) {
            return {
                hasError: function() {
                    return !failed;
                },
                response: commandResponse
            };
        },
        
        generateFullSimpleRawResponse: function() {
            var response = {};
            
            for each (var field in CARDINAL_CONST.DataFields) {
                response[field] = field + 'Test';
            }
            
            return response;
        }
    };
    
    var ns = Namespace.extendFromString(integration, "cardinal.tests");
    Namespace.extend(ns, { 
        TestCommandFactory : TestCommandFactory,
        FIRST_ORDER_FIELD_VALUES : FIRST_ORDER_FIELD_VALUES,
        AUTHENTICATE_FIELD_VALUES : AUTHENTICATE_FIELD_VALUES,
        VOID_FIELD_VALUES : VOID_FIELD_VALUES,
        COMPLEMENTARY_ORDER_FIELD_VALUES : COMPLEMENTARY_ORDER_FIELD_VALUES,
        FAILED_ORDER_FIELD_VALUES : FAILED_ORDER_FIELD_VALUES,
        generateCentinelResponseXMLString : generateCentinelResponseXMLString,
        mergeObjects : mergeObjects
    });
})();