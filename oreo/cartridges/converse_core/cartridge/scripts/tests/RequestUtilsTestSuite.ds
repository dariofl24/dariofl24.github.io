/**
 * @input Unit: Object
 */
importPackage(dw.system);
importPackage(dw.util);

importScript("constants.ds");
importScript("module_test:Framework/Assert.ds"); 
importScript("converse_core:util/RequestUtils.ds");

function execute(args : PipelineDictionary) : Number {
    let RequestUtils = converse.utils.request;
    let Ajax = converse.constants.Ajax;

    function createMap(key, value) {
        let result = new HashMap();
        result.put(key, value);

        return result;
    };

    args.Unit.describe("RequestUtils Test Suite")
        .test("RequestUtils should detect ajax request when in headers", function () {
            let currentRequest = {
                getHttpHeaders: function() {
                    return createMap(Ajax.Header.Name, Ajax.Header.Value);
                },
                getHttpParameters: function() {
                    return new HashMap();
                }
            };

            Assert.isTrue(RequestUtils.isAjax(currentRequest));
        })
        .test("RequestUtils should detect ajax request when in params", function () {
            let currentRequest = {
                getHttpHeaders: function() {
                    return new HashMap();
                },
                getHttpParameters: function() {
                    return createMap(Ajax.Parameter.Name, [Ajax.Parameter.Value]);
                }
            };

            Assert.isTrue(RequestUtils.isAjax(currentRequest));
        })
        .test("RequestUtils should not detect ajax request when format param or requested with header is missing", function () {
            let currentRequest = {
                getHttpHeaders: function() {
                    return new HashMap();
                },
                getHttpParameters: function() {
                    return new HashMap();
                }
            };

            Assert.isFalse(RequestUtils.isAjax(currentRequest));
        });

    return PIPELET_NEXT;
}
