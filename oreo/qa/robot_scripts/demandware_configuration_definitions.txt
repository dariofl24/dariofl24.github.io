*** Settings ***
Documentation     To specify configuration prerequisites in the site
Library           Selenium2Library
Resource          environment_variables.txt
Resource          common.txt
Resource          common_keywords.txt

*** Variables ***
#General definitions
#${U_MAINCONVERSELINK}    //ul[@id='mainNav']/li/a[normalize-space(text())='
${I_LOGIN}        LoginForm_Login
${I_PASSWORD}     LoginForm_Password
${I_SUBMIT}       //button[@type='submit']
${T_INTERNAL_TABLE}    //td[@id='bm_content_column']//table//table//table
${L_CONVERSESITE}    //*[@id="SelectedSiteID-wrap"]/span/span[2]/span/span[
${L_OPTIONSCATALOGS}    //tbody//td[@class='overview_subtitle']
${TD_SITENAVIGATION}    //td[@id='site_navigation_column']/table/tbody/tr/td/table/tbody
${A_SITE_CONVERSEOPTION}    /tr[1]/td/table/tbody/tr/td/table/tbody/tr/td/a
${L_HOME}         //div[@id='headermenu']/ul/li/a[@title='Business Manager home.']
#Product definitions
${L_PRODUCTCATALOG}    //a[contains(text(), 'Products and Catalogs')]
${L_ORDERINGCATALOG}    //a[contains(text(), 'Ordering')]
${L_PRODUCTS}     //a[contains(text(), 'Products')]
${L_SHIPPINGMETHODS}    //a[contains(text(), 'Shipping Methods')]
${L_LEFT_TABLE_ELEMENTS}    //td[@id='site_navigation_column']//table//table//table//table//tbody//tr
${L_SITE_OPTION}    //*[@id="SelectedSiteID-wrap"]/span/span[1]
${L_EDITPRODUCTFOUND}    /form/table/tbody/tr/td/table[1]/tbody/tr[2]/td[2]//a
${I_NAMEORID}     WFSimpleSearch_NameOrID
${I_FIND}         findSimple
${T_PRODUCTTABOPTIONS}    /table[1]/tbody/tr
${L_INVENTORYTAB}    /td[5]/a
${F_INNEREDITIONFORM}    //form/table[1]/tbody
${L_CONVERSEINVENTORY}    //a[contains(text(), 'inventory_Converse_US')]
${T_INVENTORYTABOPTIONS}    /table/tbody/tr
${L_RECORDSTAB}    /td[4]/a
${I_SEARCHTERM}    SearchTerm
${I_SIMPLESEARCH}    simpleSearch
${I_EDITINVENTORYPRODUCT}    /form[2]/table/tbody/tr[2]/td[12]/button
${T_CONTENTFORM}    //*[@id="bm_content_column"]/table/tbody/tr/td/table/tbody/tr/td[2]
${I_PRODUCTALLOCATION}    InventoryRecordForm_Allocation
${I_INSTOCKDATE}    InventoryRecordForm_InStockDate
${R_BACKORDER}    //input[@id='PreorderBackorderHandling'][@value='BACKORDER']
${I_BACKORDER_ALLOCATION}    InventoryRecordForm_PreorderBackorderAllocation
${I_UPDATE}       update
${CONFIRM}        //button[@id='ext-gen32']
${CONFIRM_WINDOW}    //div[@class='x-window x-window-plain x-window-dlg']
#SHIPPING definitions
${L_SHIPPINGMETHODTYPE}    /table/tbody/tr[3]/td/table/tbody/tr[
${S_TYPEOFPRODUCTSHIPPING}    /tr[10]/td[2]/table/tbody/tr/td/select
${B_SHIPPINGMETHOD}    //form[@id='ShippingMethodGeneral']/table/tbody/tr[15]/td/button[1]
${SHIPPINGMETHODGENERALFORM}    //*[@id="ShippingMethodGeneral"]/table/tbody
${C_SHIPPINGENABLED}    UpdateShippingMethod_ShippingMethodIsActive
${SHIPPING_RETURN}    //*[@id="bm-breadcrumb"]/a[3]
#Customer definitions
${L_CUSTOMERSCATALOG}    //a[contains(text(), 'Customers')]
${I_CUSTOMERNAME}    WFCustomerSimpleSearch_SearchTerm
${I_FINDCUSTOMER}    simpleSearch
${C_VALIDEMPLOYEE}    //tr[46]//input[@type='checkbox']
${F_EMPLOYEE_EMAIL}    //tr[47]//input
${F_EMPLOYEE_FIRSTNAME}    //tr[48]//input
${F_EMPLOYEE_LASTNAME}    //tr[49]//input
${F_EMPLOYEE_ID}    //tr[51]//input
${F_EMPLOYEE_BVATID}    //tr[52]//input
#Site Preferences definitions
${L_SITEPREFERENCES}    //a[contains(text(),'Site Preferences')]
${L_CUSTOMPREFERENCES}    //a[contains(text(), 'Custom Preferences')]
${L_SERVICE_ROWS}    /table/tbody/tr/td/table/tbody/tr/td[2]/table[2]/tbody/tr/td/table[2]/tbody/tr
${L_SERVICE}      //a[contains(text(), '
${R_CREDENTIAL_ROW}    //tr[3]
${I_CREDENTIAL_INPUT}    /td[2]/table/tbody/tr/td/input
${S_INSTANCE_SELECT}    instType
${B_INSTANCE_APPLY}    changeInstanceType
#{Product Tab Elements}
${T_PRODUCT_INVENTORY}    //a[@class='table_tabs_dis'][(text()= '
#{Site Navigatio Links}
${L_BREADCRUMB}    //a[@class='breadcrumb'][(text()='

*** Keywords ***
Open Browser To Demandware Site
    [Arguments]    ${environment}=${env_id}
    ${DWURL} =    Set Demandware URL Credentials    ${environment}
    Open Browser    ${DWURL}    ${browser}
    Maximize Browser Window
    Set Selenium Speed    ${sel_speed}
    Set Selenium Timeout    20

Set Demandware URL Credentials
    [Arguments]    ${environment}=${env_id}
    ${DWSet} =    Catenate    http://@{LIST_ENVIRONMENT}[${environment}].demandware.net/on/demandware.store/Sites-Site
    [Return]    ${DWSet}

Log In Demandware
    [Arguments]    ${environment}=${env_id}
    Wait Until Page Contains Element    ${I_SUBMIT}
    Input Text    ${I_LOGIN}    @{DW_LOGIN}[${environment}]
    Input Text    ${I_PASSWORD}    @{DW_PASS}[${environment}]
    Click Element    ${I_SUBMIT}

Open Demandware
    [Arguments]    ${environment}=${env_id}
    Open Browser To Demandware Site    ${environment}
    Log In Demandware    ${environment}
    Select Site    ${environment}

Select Site
    [Arguments]    ${environment}=${env_id}
    Click at Site Option
    ${localesite} =    Catenate    @{ENV_LOCALENAME}[${environment}]
    Select Converse Site    ${localesite}

Select Converse Site
    [Arguments]    ${localename}
    Wait Until Page Contains Element    ${L_CONVERSESITE}${localename}]
    Click Element    ${L_CONVERSESITE}${localename}]

Click at Product Catalog
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_PRODUCTCATALOG}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_PRODUCTCATALOG}
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_PRODUCTS}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_PRODUCTS}

Click At Customers Catalog
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_CUSTOMERSCATALOG}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_CUSTOMERSCATALOG}

Click At Ordering
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_ORDERINGCATALOG}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_ORDERINGCATALOG}

Click At Shipping Methods
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_SHIPPINGMETHODS}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_SHIPPINGMETHODS}

Click at Site Option
    Wait Until Page Contains Element    ${L_SITE_OPTION}
    Click Element    ${L_SITE_OPTION}

Click at Site Preferences
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_SITEPREFERENCES}
    Click Element    ${T_INTERNAL_TABLE}${L_SITEPREFERENCES}

Click At Custom Preferences
    Wait Until Page Contains Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_CUSTOMPREFERENCES}
    Click Element    ${T_INTERNAL_TABLE}${L_OPTIONSCATALOGS}${L_CUSTOMPREFERENCES}

Open Service Configuration
    [Arguments]    ${serviceName}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_SERVICE}${serviceName}')]
    Click Element    ${T_CONTENTFORM}${L_SERVICE}${serviceName}')]

Edit a Product In Catalog
    [Arguments]    ${product}
    Wait Until Page Contains Element    ${I_NAMEORID}
    Input Text    ${I_NAMEORID}    ${product}
    Click Element    ${I_FIND}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_EDITPRODUCTFOUND}
    Click Element    ${T_CONTENTFORM}${L_EDITPRODUCTFOUND}

Edit a Customer In Catalog
    [Arguments]    ${customer}
    Wait Until Page Contains Element    ${I_CUSTOMERNAME}
    Input Text    ${I_CUSTOMERNAME}    ${customer}
    Click Element    ${I_FINDCUSTOMER}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_EDITPRODUCTFOUND}
    Click Element    ${T_CONTENTFORM}${L_EDITPRODUCTFOUND}

Click Product Register Tab
    [Arguments]    ${tabName}
    Wait Until Page Contains Element    ${T_PRODUCT_INVENTORY}${tabName}')]
    Click Element    ${T_PRODUCT_INVENTORY}${tabName}')]

Configure Inventory Values
    [Arguments]    ${product_id}    ${allocation}    ${instockdate}    ${backorderallocation}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${T_PRODUCTTABOPTIONS}${L_INVENTORYTAB}
    Click Element    ${T_CONTENTFORM}${T_PRODUCTTABOPTIONS}${L_INVENTORYTAB}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_CONVERSEINVENTORY}
    Click Element    ${T_CONTENTFORM}${L_CONVERSEINVENTORY}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${T_INVENTORYTABOPTIONS}${L_RECORDSTAB}
    Click Element    ${T_CONTENTFORM}${T_INVENTORYTABOPTIONS}${L_RECORDSTAB}
    Wait Until Page Contains Element    ${I_SEARCHTERM}
    Input Text    ${I_SEARCHTERM}    ${product_id}
    Click Element    ${I_SIMPLESEARCH}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${I_EDITINVENTORYPRODUCT}
    Click Element    ${T_CONTENTFORM}${I_EDITINVENTORYPRODUCT}
    Edit Product Allocation    100    ${instockdate}    1
    Edit Product Allocation    ${allocation}    ${instockdate}    ${backorderallocation}

Edit Product Allocation
    [Arguments]    ${allocation}    ${instockdate}    ${backorderallocation}
    Wait Until Page Contains Element    ${I_PRODUCTALLOCATION}
    Input Text    ${I_PRODUCTALLOCATION}    ${allocation}
    Click Element    ${R_BACKORDER}
    Input Text    ${I_INSTOCKDATE}    ${instockdate}
    Input Text    ${I_BACKORDER_ALLOCATION}    ${backorderallocation}
    Click Element    ${I_UPDATE}
    Sleep    2
    Run Keyword And Ignore Error    Update Inventory

Set Inventory For Product
    [Arguments]    ${product_id}    ${setallocation}    ${setinstockdate}    ${setbackorderallocation}
    Click at Product Catalog
    Edit a Product In Catalog    ${product_id}
    Configure Inventory Values    ${product_id}    ${setallocation}    ${setinstockdate}    ${setbackorderallocation}

Set Allocation for Product
    [Arguments]    ${productId}    ${allocation}    ${setinstockdate}    ${setbackorderallocation}
    Click at Product Catalog
    Edit a Product In Catalog    ${product_id}
    Configure Inventory Values    ${product_id}    ${allocation}    ${setinstockdate}    ${setbackorderallocation}

Configure Allocation Values
    [Arguments]    ${product_id}    ${allocation}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${T_PRODUCTTABOPTIONS}${L_INVENTORYTAB}
    Click Element    ${T_CONTENTFORM}${T_PRODUCTTABOPTIONS}${L_INVENTORYTAB}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_CONVERSEINVENTORY}
    Click Element    ${T_CONTENTFORM}${L_CONVERSEINVENTORY}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${T_INVENTORYTABOPTIONS}${L_RECORDSTAB}
    Click Element    ${T_CONTENTFORM}${T_INVENTORYTABOPTIONS}${L_RECORDSTAB}
    Wait Until Page Contains Element    ${I_SEARCHTERM}
    Input Text    ${I_SEARCHTERM}    ${product_id}
    Click Element    ${I_SIMPLESEARCH}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${I_EDITINVENTORYPRODUCT}
    Click Element    ${T_CONTENTFORM}${I_EDITINVENTORYPRODUCT}
    Wait Until Page Contains Element    ${I_PRODUCTALLOCATION}
    Input Text    ${I_PRODUCTALLOCATION}    ${allocation}
    Click Element    ${R_BACKORDER}
    Input Text    ${I_INSTOCKDATE}    ${instockdate}
    Input Text    ${I_BACKORDER_ALLOCATION}    ${backorderallocation}
    Click Element    ${I_UPDATE}
    Sleep    2
    Run Keyword And Ignore Error    Update Inventory

Update Inventory
    Click Element    ${CONFIRM}

Setting Up Shipping Methods
    [Arguments]    ${producttype}    @{shippingMethods}
    Click At Ordering
    Click At Shipping Methods
    : FOR    ${shippingMethod}    IN    @{shippingMethods}
    \    Set Shipping Method    ${shippingMethod}    ${producttype}

Set Shipping Method
    [Arguments]    ${method}    ${producttype}
    Wait Until Page Contains Element    ${T_CONTENTFORM}${L_SHIPPINGMETHODTYPE}${method}]/td[2]/a
    Click Element    ${T_CONTENTFORM}${L_SHIPPINGMETHODTYPE}${method}]/td[2]/a
    Wait Until Page Contains Element    ${SHIPPINGMETHODGENERALFORM}${S_TYPEOFPRODUCTSHIPPING}
    Select Checkbox    ${C_SHIPPINGENABLED}
    Select From List    ${SHIPPINGMETHODGENERALFORM}${S_TYPEOFPRODUCTSHIPPING}    ${producttype}
    Click Element    ${B_SHIPPINGMETHOD}
    Sleep    4
    Click Element    ${SHIPPING_RETURN}

Return to Demandware Homepage
    Wait Until Page Contains Element    ${L_HOME}
    Click Element    ${L_HOME}
    Select Site
    Select Site

Return by Breadcrumb
    [Arguments]    ${breadcrum}
    Wait Until Page Contains Element    ${L_BREADCRUMB}${breadcrum}')]
    Click Element    ${L_BREADCRUMB}${breadcrum}')]

Change Instance in Staging Only
    [Arguments]    ${environment}
    Wait Until Page Contains Element    ${S_INSTANCE_SELECT}
    Select From List By Value    ${S_INSTANCE_SELECT}    ${environment}
    Click Element    ${B_INSTANCE_APPLY}
    Sleep    1

Configure Test Employee
    [Arguments]    ${employeefile}    ${employeecatalog}    ${employeeimportlink}    ${not}
    Import Test Catalog    ${employeefile}    ${employeecatalog}    ${employeeimportlink}    ${not}
