*** Settings ***
Resource        site_declarations.txt
Resource        environment_variables.txt
Resource        account_settings_definitions.txt
Library         Selenium2Library

*** Variables ***
${I_EMPLOYEE_EMAIL}  dwfrm_mrtaylorstore_customer_email
${B_VERIFY}     dwfrm_mrtaylorstore_verify
${I_EMPLOYEE_PASS}  dwfrm_mrtaylorstore_login_password
${I_EMPLOYEE_FIRSTNAME}  dwfrm_mrtaylorstore_customer_firstname
${I_EMPLOYEE_LASTNAME}  dwfrm_mrtaylorstore_customer_lastname
${I_EMPLOYEE_ZIPCODE}  //div[@id='zip-cell']/div/input[1]
${I_EMPLOYEE_ID}  dwfrm_mrtaylorstore_customer_employeeid
${I_EMPLOYEE_SSN}  dwfrm_mrtaylorstore_customer_ssn
${B_CONTINUE}   dwfrm_mrtaylorstore_register
${C_AGREETERMS}  dwfrm_mrtaylorstore_customer_terms
${D_EMPLOYEEFORM}  //form[@id='register-employee-form']
${S_MONTH}      //select[@id='month']
${S_DAY}        //select[@id='day']
${S_YEAR}       //select[@id='year']
${R_GENDER}     dwfrm_mrtaylorstore_customer_gender
${I_REGISTEREMPLOYEE}  //a[@id='add-family-link']
${D_MRTAYLORCONTAINER}  //div[@id='mr-taylor-container']
${L_ADDNEW_RELATIVE}  //a[@class='button add-new-member-button']
${I_RELATIVE_NAME}  dwfrm_family_firstname
${I_RELATIVE_LASTNAME}  dwfrm_family_lastname
${I_RELATIVE_EMAIL}  dwfrm_family_email
${S_RELATIONSHIP}  dwfrm_family_relationship
${B_SAVERELATIVE}  save-new-member-btn
${LI_RELATIVES_ADDED}  //div[@id='family-members-container']/ul/li
${B_REMOVE_RELATIVE}  //div[@id='family-members-container']/ul/li[1]//button

*** Keywords ***
Register Employee
  [Arguments]  ${secondStep}  ${registerStep}  ${loginStep}  ${emailuser}  ${name}  ${lastName}
  ...  ${employee}  ${last4}  ${zip}  ${mailResponse}  ${password}  ${passResponse}
  ${UserAcc} =  Get Time  epoch
  ${newUseremail}=  Set Variable  ${UserAcc}${emailUser}
  Open Browser To Converse Site
  Go To  http://@{LIST_ENVIRONMENT}[${env_id}]${EMPLOYEE_REGISTERPAGE}
  Run Keyword If  '${registerStep}'=='False'  Submit Email  ${emailuser}  ELSE  Submit Email  ${newUseremail}
  Pass Execution If  '${secondStep}'=='False'  Negative test succesfully ended
  Register Employee in Converse
  Run Keyword If  '${loginStep}' =='True'  Check Succesfully Registered Employee

Check Succesfully Registered Employee
  Page Should Contain  ${REGISTERED_EMPLOYEE_MESSAGE}
  Wait Until Page Contains Element  ${D_MRTAYLORCONTAINER}${I_REGISTEREMPLOYEE}
  Navigate to My Family
  Click Element  ${L_ADDNEW_RELATIVE}
  Add Family Members

Submit Email
  [Arguments]  ${employeeEmail}
  Input Text  ${I_EMPLOYEE_EMAIL}  ${employeeEmail}
  Click Button  ${B_VERIFY}
  Wait Until Page Contains  ${mailResponse}

Register Employee in Converse
  Input Text  ${I_EMPLOYEE_PASS}  ${password}
  Input Text  ${I_EMPLOYEE_FIRSTNAME}  ${name}
  Input Text  ${I_EMPLOYEE_LASTNAME}  ${lastName}
  Input Text  ${I_EMPLOYEE_ZIPCODE}  ${zip}
  Input Text  ${I_EMPLOYEE_ID}  ${employee}
  Input Text  ${I_EMPLOYEE_SSN}  ${last4}
  Run Keyword If  '${registerStep}'=='True'  Select From List  ${D_EMPLOYEEFORM}${S_MONTH}  1
  Run Keyword If  '${registerStep}'=='True'  Select From List  ${D_EMPLOYEEFORM}${S_DAY}  26
  Run Keyword If  '${registerStep}'=='True'  Select From List  ${D_EMPLOYEEFORM}${S_YEAR}  1980
  Run Keyword If  '${registerStep}'=='True'  Select Radio Button  ${R_GENDER}  2
  Select Checkbox  ${C_AGREETERMS}
  Click Button  ${B_CONTINUE}
  Wait Until Page Contains  ${passResponse}

Navigate to My Family
  Wait Until Page Contains Element  ${A_HIMENU}
  Sleep  4
  Click Element  ${A_HIMENU}
  Wait Until Page Contains Element  ${LI_MYFAMILY}
  Click Element  ${LI_MYFAMILY}
  Wait Until Page Contains  My Family
  Remove Previous Registered Relatives

Remove Previous Registered Relatives
  ${qty} =  Get Matching Xpath Count  ${LI_RELATIVES_ADDED}
  Run Keyword If  ${qty}>0  Remove Relatives  ${qty}

Remove Relatives
  [Arguments]  ${qty}
  : FOR  ${any}  IN RANGE  ${qty}
  \  Remove Relative

Remove Relative
  Wait Until Page Contains Element  ${B_REMOVE_RELATIVE}
  Click Element  ${B_REMOVE_RELATIVE}
  Sleep  3

Add Family Members
  ${email} =  Get Time  epoch
  ${email} =  Catenate  ${email}_test@gmail.com
  Wait Until Page Contains Element  ${I_RELATIVE_NAME}
  Input Text  ${I_RELATIVE_NAME}  robot name
  Input Text  ${I_RELATIVE_LASTNAME}  robot last name
  Input Text  ${I_RELATIVE_EMAIL}  ${email}
  Select From List  ${S_RELATIONSHIP}  5
  Click Button  ${B_SAVERELATIVE}
  Sleep  3
  Page Should Contain  ${email}
