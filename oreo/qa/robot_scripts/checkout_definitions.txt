*** Settings ***
Resource          site_declarations.txt
Resource          pdp_declarations.txt
Resource          environment_variables.txt
Resource          common.txt
Resource          cart_definitions.txt
Library           Selenium2Library
Library           String

*** Variables ***
${F_SHIPPINGFORM}    //form[@id='dwfrm_singleshipping_shippingAddress']
${F_BILLINGFORM}    //form[@id='dwfrm_billing']
#${B_CHECKOUT}    //div[@id='secondary']//div[@class='checkout-options']//button[@class='checkout-button button']
${B_CHECKOUT}     //button[@class='checkout-button button']
${I_FNAME}        //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_common_firstName']
${I_LNAME}        //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_common_lastName']
${I_ADDRESS1}     //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_common_address1']
${I_CITY}         //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_common_city']
${S_STATE}        //select[@id='dwfrm_singleshipping_shippingAddress_addressFields_states_stateCode']
${I_SZIPCODE}     //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_regional_zip']
${I_PHONE}        //input[@id='dwfrm_singleshipping_shippingAddress_addressFields_phone']
${B_CONTINUEBILLING}    dwfrm_singleshipping_shippingAddress_save
${I_BFNAME}       //input[@id='dwfrm_billing_billingAddress_addressFields_common_firstName']
${I_BLNAME}       //input[@id='dwfrm_billing_billingAddress_addressFields_common_lastName']
${I_BADDRESS1}    //input[@id='dwfrm_billing_billingAddress_addressFields_common_address1']
${I_BCITY}        //input[@id='dwfrm_billing_billingAddress_addressFields_common_city']
${S_BSTATE}       //select[@id='dwfrm_billing_billingAddress_addressFields_states_stateCode']
${I_BZIPCODE}     //input[@id='dwfrm_billing_billingAddress_addressFields_regional_zip']
${I_BPHONE}       //input[@id='dwfrm_billing_billingAddress_addressFields_regional_phone']
${I_EMAIL1}       //input[@id='dwfrm_billing_billingAddress_email_emailAddress']
${I_EMAIL2}       //input[@id='dwfrm_billing_billingAddress_email_confirmationEmailAddress']
${I_NAMEONCARD}    //input[@id='dwfrm_billing_paymentMethods_creditCard_owner']
${S_CARDTYPE}     //select[@id='dwfrm_billing_paymentMethods_creditCard_type']
${I_CARDNUMBER}    //input[@id='dwfrm_billing_paymentMethods_creditCard_number']
${S_EXPMONTH}     //select[@id='dwfrm_billing_paymentMethods_creditCard_month']
${S_EXPYEAR}      //select[@id='dwfrm_billing_paymentMethods_creditCard_year']
${I_SECCODE}      //input[@id='dwfrm_billing_paymentMethods_creditCard_cvn']
${B_VERIFYBUTTON}    //button[@class='btn-continue']
${B_EDITSHIPPING}    //div[@id='primary']/ul/li[1]//a[@class='btn-edit-step']
${I_GCMETHOD}     //div[@class='payment-method-info']//input[@id='dwfrm_billing_giftCardPayment_enable']
${I_GIFTCARDNUMBER}    //input[@id='dwfrm_billing_giftCardPayment_cardNumber']
${I_PIN}          //input[@id='dwfrm_billing_giftCardPayment_pin']
${B_APPLYGC}      //button[@name='dwfrm_billing_giftCardPayment_applyGiftCard']
${verify_once}    False
${B_LOGINFROMSHIPPING}    //div[@class='form-row login-faster-checkout']//button
${B_SUBMITORDER}    //div[@class='order-summary-footer']//form[@class='submit-order']//div[@class='form-row']//button
${URL_CART}       Cart-Show
${D_MAIN}         //div[@id='main']
${I_PAYPAL_NAME}    dwfrm_billing_paymentMethods_selectedPaymentMethodID
${B_GOTOPAYPAL}    //div[@id='primary']//form[@id='dwfrm_billing']//button[@value='Continue']
${S_SAVEDADDRSHIPPING}    //select[@id='dwfrm_singleshipping_addressList']
${S_SAVEDADDRBILLING}    //*[@id="dwfrm_billing_addressList"]
${D_VERIFYSHIPPING}    //div[@id='primary']/ul/li[1]/div/div/div[3]/ul[1]/li[3]
${D_VERIFYBILLING}    //div[@id='primary']/ul/li[2]/div/div/div[3]/ul[1]/li[3]
${D_VFYSHPMETHOD}    //div[@id='primary']/ul/li[1]/div/div/div[3]/ul[2]/li[2]
${D_PLACESHIPPING}    //div[@class='shipping column']/ul/li[3]
${D_PLACEBILLING}    //div[@class='billing column']/ul/li[3]
${S_SHIPPINGMETHOD}    //select[@name='regular-shipping-methods']
${I_COPYSHIPBILL}    //input[@id='dwfrm_billing_billingAddress_billingSameAsShipping']
${L_CITYZCSTATE}    //div[@class='form-row billing-address']//li[3][contains (text(),'
${B_REMOVEITEM}    //button[@id='dwfrm_cart_shipments_i0_items_i0_deleteProduct']
${LI_BILLINGINFO}    //div[@class='checkout-step billing-info inactive']//ul[1]/li[

*** Keywords ***
Fill Checkout Info For Color and Size Validations
    [Arguments]    ${name}=${validSite_name}    ${lastName}=${validSite_lastName}    ${address1}=${DEFAULTADDRESS}    ${city}=${DEFAULTCITY}    ${state}=${DEFAULTSTATE}    ${zipcode}=${DEFAULTZIPCODE}
    ...    ${phone}=${DEFAULTPHONE}    ${email}=${validSite_user}    ${nameOnCard}=${validSite_name} ${validSite_lastName}    ${cardType}=${DEFAULTTYPECC}    ${cardNumber}=${DEFAULTCC}    ${exp_Month}=${DEFAULTEXPMONTH}
    ...    ${exp_Year}=${DEFAULTEXPYEAR}    ${secCode}=${DEFAULTSECCODE}    ${PageMessage}=3. ORDER PREVIEW
    Fill Shipping Info
    Verify Color and Size In Page    ${productColor}    ${InlineSize}
    Click Continue To Billing Info
    Fill Credit Card Data
    Fill Billing Data
    Send Billing Info
    Verify Color and Size In Page    ${productColor}    ${InlineSize}

Start Checkout
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Start Checkout US
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='UK'    Start Checkout UK

Start Checkout US
    Open Browser to Converse Site
    Search Specific Product    ${id_Inlineproduct}
    Add One Product to Cart from PDP
    Click Checkout Button from Cart

Add One Product to Cart from PDP
    Set a Product Number    1
    Select Product Size
    Add a Product to Cart
    Open Cart

Remove Item from Cart
    Open Cart
    Wait Until Page Contains Element    ${B_REMOVEITEM}
    Click Button    ${B_REMOVEITEM}
    ${legend} =    Confirm Action
    Should Be Equal    ${legend}    Are you sure you want to remove the item?
    Wait Until Page Contains    Your Cart is Empty

Start Checkout with Specific Qty
    [Arguments]    ${qty}    ${productID}=${id_Inlineproduct}
    Search Specific Product    ${productID}
    Add One Product to Cart from PDP
    Run Keyword If    ${qty}>1    Set Product Quantity from Cart    ${qty}
    Click Checkout Button from Cart

Start Paypal Checkout
    Wait Until Page Contains Element    footer    160
    Search Specific Product    ${id_Inlineproduct}
    Add One Product to Cart from PDP

Start Paypal Checkout from Shipping
    Start Paypal Checkout
    Click Checkout Button from Cart

Start PayPal Checkout from Cart
    Start Paypal Checkout
    Click Paypal from Cart Option

Continue checkout with Gift Card
    [Arguments]    ${name}=${validSite_name}    ${lastName}=${validSite_lastName}    ${address1}=${DEFAULTADDRESS}    ${city}=${DEFAULTCITY}    ${state}=${DEFAULTSTATE}    ${zipcode}=${DEFAULTZIPCODE}
    ...    ${phone}=${DEFAULTPHONE}    ${email}=${validSite_user}    ${PageMessage}=Gift Card Total
    Fill Shipping Info
    Click Continue To Billing Info
    Fill Giftcard Info
    Fill Billing Data
    Send Billing Info
    Verify Order Message    ${PageMessage}

Continue checkout with Credit Card
    [Arguments]    ${name}=${validSite_name}    ${lastName}=${validSite_lastName}    ${address1}=${DEFAULTADDRESS}    ${city}=${DEFAULTCITY}    ${state}=${DEFAULTSTATE}    ${zipcode}=${DEFAULTZIPCODE}
    ...    ${phone}=${DEFAULTPHONE}    ${email}=${validSite_user}    ${nameOnCard}=${validSite_name} ${validSite_lastName}    ${cardType}=${DEFAULTTYPECC}    ${cardNumber}=${DEFAULTCC}    ${exp_Month}=${DEFAULTEXPMONTH}
    ...    ${exp_Year}=${DEFAULTEXPYEAR}    ${secCode}=${DEFAULTSECCODE}    ${PageMessage}=Complete Your Purchase
    Fill Shipping Info
    Click Continue To Billing Info
    Fill Credit Card Data
    Fill Billing Data
    Send Billing Info
    Verify Order Message    ${PageMessage}

Continue checkout verifying Shipping method
    [Arguments]    ${name}=${validSite_name}    ${lastName}=${validSite_lastName}    ${address1}=${DEFAULTADDRESS}    ${city}=${DEFAULTCITY}    ${state}=${DEFAULTSTATE}    ${zipcode}=${DEFAULTZIPCODE}
    ...    ${phone}=${DEFAULTPHONE}    ${email}=${validSite_user}    ${nameOnCard}=${validSite_name} ${validSite_lastName}    ${cardType}=${DEFAULTTYPECC}    ${cardNumber}=${DEFAULTCC}    ${exp_Month}=${DEFAULTEXPMONTH}
    ...    ${exp_Year}=${DEFAULTEXPYEAR}    ${secCode}=${DEFAULTSECCODE}    ${PageMessage}=Complete Your Purchase
    Fill Shipping Info
    ${smethod} =    Select Random Option    ${F_SHIPPINGFORM}${S_SHIPPINGMETHOD}
    ${smethod2} =    Remove String Using Regexp    ${smethod}    \\s    ''
    Click Continue To Billing Info
    Verify Shipping Method    ${smethod2}
    Fill Credit Card Data
    Fill Billing Data
    Send Billing Info
    Verify Order Message    ${PageMessage}
    Verify Shipping Method    ${smethod2}

Continue checkout verifying Mirror Address Option
    [Arguments]    ${name}=${validSite_name}    ${lastName}=${validSite_lastName}    ${address1}=${DEFAULTADDRESS}    ${city}=${DEFAULTCITY}    ${state}=${DEFAULTSTATE}    ${zipcode}=${DEFAULTZIPCODE}
    ...    ${phone}=${DEFAULTPHONE}    ${email}=${validSite_user}    ${nameOnCard}=${validSite_name} ${validSite_lastName}    ${cardType}=${DEFAULTTYPECC}    ${cardNumber}=${DEFAULTCC}    ${exp_Month}=${DEFAULTEXPMONTH}
    ...    ${exp_Year}=${DEFAULTEXPYEAR}    ${secCode}=${DEFAULTSECCODE}    ${PageMessage}=Complete Your Purchase
    Fill Shipping Info
    Click Continue To Billing Info
    Fill Credit Card Data
    Use Shipping info as Mirror
    Send Billing Info
    Verify Order Message    ${PageMessage}
    Verify Shipping-Billing Mirror in Order Preview

Use Shipping info as Mirror
    Wait Until Page Contains Element    ${I_COPYSHIPBILL}
    Select Checkbox    ${I_COPYSHIPBILL}
    Input Text    ${F_BILLINGFORM}${I_EMAIL1}    ${email}
    Input Text    ${F_BILLINGFORM}${I_EMAIL2}    ${email}
    Input Text    ${F_BILLINGFORM}${I_BPHONE}    ${phone}

Verify Shipping-Billing Mirror in Order Preview
    Element Should Contain    ${LI_BILLINGINFO}2]    ${address1}
    Element Should Contain    ${LI_BILLINGINFO}3]    ${city}
    Element Should Contain    ${LI_BILLINGINFO}3]    ${zipcode}

Fill Shipping Standard
    [Arguments]    ${name}    ${lastName}    ${address1}    ${city}    ${state}    ${zipcode}
    Fill Shipping Info
    Click Continue To Billing Info

Click Continue To Billing Info
    Click Button    ${B_CONTINUEBILLING}

Fill Shipping Information and verifies elements
    [Arguments]    ${name}    ${lastName}    ${address1}    ${city}    ${state}    ${zipcode}
    ...    ${phone}
    Fill Shipping Info

Fill Shipping Info
    Wait Until Page Contains Element    ${F_SHIPPINGFORM}${I_FNAME}
    Input Text    ${F_SHIPPINGFORM}${I_FNAME}    ${name}
    Input Text    ${F_SHIPPINGFORM}${I_LNAME}    ${lastName}
    Input Text    ${F_SHIPPINGFORM}${I_ADDRESS1}    ${address1}
    Input Text    ${F_SHIPPINGFORM}${I_CITY}    ${city}
    Input Text    ${F_SHIPPINGFORM}${I_SZIPCODE}    ${zipcode}
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Select From List    ${F_SHIPPINGFORM}${S_STATE}    ${state}
    Sleep    1
    Click Element    ${F_SHIPPINGFORM}${I_CITY}

Fill Billing Data
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_BFNAME}
    Input Text    ${F_BILLINGFORM}${I_BFNAME}    ${name}
    Input Text    ${F_BILLINGFORM}${I_BLNAME}    ${lastName}
    Input Text    ${F_BILLINGFORM}${I_BADDRESS1}    ${address1}
    Input Text    ${F_BILLINGFORM}${I_BCITY}    ${city}
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Select from List    ${F_BILLINGFORM}${S_BSTATE}    ${state}
    Input Text    ${F_BILLINGFORM}${I_BZIPCODE}    ${zipcode}
    Input Text    ${F_BILLINGFORM}${I_BPHONE}    ${phone}
    Input Text    ${F_BILLINGFORM}${I_EMAIL1}    ${email}
    Input Text    ${F_BILLINGFORM}${I_EMAIL2}    ${email}

Fill Credit Card Data
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_CARDNUMBER}
    Select From List    ${F_BILLINGFORM}${S_CARDTYPE}    ${cardType}
    Input Text    ${F_BILLINGFORM}${I_CARDNUMBER}    ${cardNumber}
    Select From List    ${F_BILLINGFORM}${S_EXPMONTH}    ${exp_Month}
    Select From List    ${F_BILLINGFORM}${S_EXPYEAR}    ${exp_Year}
    Input Text    ${F_BILLINGFORM}${I_SECCODE}    ${secCode}

Send Billing Info
    Click Button    ${F_BILLINGFORM}${B_VERIFYBUTTON}

Verify Order Message
    [Arguments]    ${PageMessage}
    Wait Until Page Contains    ${PageMessage}

Verify Navigation from PDP to Checkout Page
    Wait Until Page Contains Element    ${D_MAIN}
    Location Should Contain    ${URL_CART}

Verify Login Button Displays Login Form
    Wait Until Page Contains Element    ${F_SHIPPINGFORM}${B_LOGINFROMSHIPPING}
    Click Button    ${F_SHIPPINGFORM}${B_LOGINFROMSHIPPING}
    Verify Login Form is Expanded

Click Checkout Button from Cart
    Wait Until Page Contains Element    ${B_CHECKOUT}
    Click Element    ${B_CHECKOUT}

Click at Submit Order and Verifies Retrieves Message
    Wait Until Page Contains Element    ${B_SUBMITORDER}
    Click Element    ${B_SUBMITORDER}
    Wait Until Page Contains    Your Order is Complete!

Fill Giftcard Info
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_GCMETHOD}
    Click Element    ${F_BILLINGFORM}${I_GCMETHOD}
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_GIFTCARDNUMBER}
    Input Text    ${F_BILLINGFORM}${I_GIFTCARDNUMBER}    ${valid_gc_number}
    Input Text    ${F_BILLINGFORM}${I_PIN}    ${valid_gc_pin}
    Click Button    ${F_BILLINGFORM}${B_APPLYGC}

Select Payment with Paypal
    Sleep    4
    Wait Until Page Contains    Payment Method
    Select Radio Button    ${I_PAYPAL_NAME}    PAY_PAL

Click to Continue to Paypal Site
    Wait Until Page Contains Element    ${B_GOTOPAYPAL}
    Click Element    ${B_GOTOPAYPAL}
    #Wait Until Page Contains    @{PAYPAL_PAGETITLE}[${env_id}]
    #Wait Until Page Contains    @{PAYPAL_PAGETITLE}

Verify Preset Shipping Information
    [Arguments]    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}
    Wait Until Page Contains Element    ${F_SHIPPINGFORM}${I_FNAME}
    Page Should Contain Element    ${F_SHIPPINGFORM}${I_FNAME}[@value='${psName}']
    Page Should Contain Element    ${F_SHIPPINGFORM}${I_LNAME}[@value='${psLastName}']
    Page Should Contain Element    ${F_SHIPPINGFORM}${I_ADDRESS1}[@value='${psAddress1}']
    Page Should Contain Element    ${F_SHIPPINGFORM}${I_CITY}[@value='${psCity}']
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Check Present State in Form    ${S_STATE}    ${psState}
    Page Should Contain Element    ${F_SHIPPINGFORM}${I_SZIPCODE}[@value='${psZipCode}']

Check Present State in Form
    [Arguments]    ${locatorState}    ${state}
    ${stateSelected} =    Get Selected List Label    ${locatorState}
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Should Contain    ${stateSelected}    ${state}

Verify Preset Billing Information
    [Arguments]    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}
    ...    ${psPhone}
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_BFNAME}
    Page Should Contain Element    ${F_BILLINGFORM}${I_BFNAME}[@value='${psName}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_BLNAME}[@value='${psLastName}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_BADDRESS1}[@value='${psAddress1}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_BCITY}[@value='${psCity}']
    Run Keyword If    '@{ENV_LOCALE}[${env_id}]'=='US'    Check Present State in Form    ${S_BSTATE}    ${psState}
    Page Should Contain Element    ${F_BILLINGFORM}${I_BZIPCODE}[@value='${psZipCode}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_EMAIL1}[@value='${validSite_user}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_EMAIL1}[@value='${validSite_user}']
    Page Should Contain Element    ${F_BILLINGFORM}${I_BPHONE}[@value='${psPhone}']

Select Other Saved Shipping Address
    [Arguments]    ${value}
    Select From List By Value    ${F_SHIPPINGFORM}${S_SAVEDADDRSHIPPING}    ${value}

Select Other Saved Billing Address
    [Arguments]    ${value}
    Select From List By Value    ${F_BILLINGFORM}${S_SAVEDADDRBILLING}    ${value}

Verify Default Saved Shipping Address
    [Arguments]    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}
    Verify Preset Shipping Information    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}

Change Saved Shipping Address
    [Arguments]    ${psCity}    ${psState}    ${psZipCode}    ${nick}
    Select Other Saved Shipping Address    ${nick}
    Click Continue To Billing Info
    Wait Until Page Contains Element    ${D_VERIFYSHIPPING}
    Element Text Should Be    ${D_VERIFYSHIPPING}    ${psCity}, ${psState} ${psZipCode}

Verify Default Saved Billing Address
    [Arguments]    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}
    ...    ${psPhone}
    Verify Preset Billing Information    ${psName}    ${psLastName}    ${psAddress1}    ${psCity}    ${psState}    ${psZipCode}
    ...    ${psPhone}

Change Saved Billing Address
    [Arguments]    ${psCity}    ${psState}    ${psZipCode}    ${nick}
    Fill Credit Card Data Using    Visa    4111111111111111    January    2018    232
    Select Other Saved Billing Address    ${nick}
    Send Billing Info
    Wait Until Page Contains Element    ${D_VERIFYBILLING}
    Element Text Should Be    ${D_VERIFYBILLING}    ${psCity}, ${psState} ${psZipCode}

Place Order and Verify Shipping and Billing Addresses
    [Arguments]    ${ShippingCity}    ${ShippingState}    ${ShippingZipCode}    ${BillingCity}    ${BillingState}    ${BillingZipCode}
    Click at Submit Order and Verifies Retrieves Message
    Element Text Should Be    ${D_PLACESHIPPING}    ${ShippingCity}, ${ShippingState} ${ShippingZipCode}
    Element Text Should Be    ${D_PLACEBILLING}    ${BillingCity}, ${BillingState} ${BillingZipCode}

Verify Shipping Method
    [Arguments]    ${shippingMethod}
    Wait Until Page Contains Element    ${D_VFYSHPMETHOD}
    ${shippingValue} =    Get Text    ${D_VFYSHPMETHOD}
    ${shippingValue} =    Remove String Using Regexp    ${shippingValue}    \\s    ''
    Should Contain    ${shippingValue}    ${shippingMethod}

Fill Credit Card Data Using
    [Arguments]    ${cardType}    ${cardNumber}    ${exp_Month}    ${exp_Year}    ${secCode}
    Wait Until Page Contains Element    ${F_BILLINGFORM}${I_CARDNUMBER}
    Select From List    ${F_BILLINGFORM}${S_CARDTYPE}    ${cardType}
    Input Text    ${F_BILLINGFORM}${I_CARDNUMBER}    ${cardNumber}
    Select From List    ${F_BILLINGFORM}${S_EXPMONTH}    ${exp_Month}
    Select From List    ${F_BILLINGFORM}${S_EXPYEAR}    ${exp_Year}
    Input Text    ${F_BILLINGFORM}${I_SECCODE}    ${secCode}
