*** Settings ***
Library         Selenium2Library
Resource        cart_definitions.txt
Library         String

*** Variables ***
${NODESSTYLES}  GetPricesService/response/prices/price/styleNumber
${ECN_IFRAME}   //iframe[contains(@src, '
${ADD_TO_CART_BUTTON}  //div[@id='palette']/div[2]/a[3]
${CONFIRM_DESIGN_BUTTON}  //a[@class='button confirm-design']

*** Keywords ***
Check DYO
  Add DYO To Cart
  Open Cart
  Run Keyword If  '@{ENV_LOCALE}[${env_id}]'=='US'  Verify DYO's Attributes In Cart  ${US_PRODUCT}  ${US_PRODUCT_ID}
  Run Keyword If  '@{ENV_LOCALE}[${env_id}]'=='UK'  Verify DYO's Attributes In Cart  ${UK_PRODUCT}  ${UK_PRODUCT_ID}

Add DYO To Cart
  Open ECN
  ${USdyoURL} =  Set US DYO URL
  ${UKdyoURL} =  Set UK DYO URL
  Run Keyword If  '@{ENV_LOCALE}[${env_id}]'=='US'  Go To  ${USdyoURL}
  Run Keyword If  '@{ENV_LOCALE}[${env_id}]'=='UK'  Go To  ${UKdyoURL}
  Wait Until Page Contains Element  ${ECN_IFRAME}@{BUI_CREDENTIALS_TEST}[0]')]  240
  Select Frame  ${ECN_IFRAME}@{BUI_CREDENTIALS_TEST}[0]')]
  Wait Until Page Contains Element  ${ADD_TO_CART_BUTTON}
  Click Element  ${ADD_TO_CART_BUTTON}
  Select Window  main
  Wait Until Page Contains Element  ${CONFIRM_DESIGN_BUTTON}
  Click Element  ${CONFIRM_DESIGN_BUTTON}
  Sleep  5

Set UK DYO URL
  ${URLCred}=  Catenate  http://@{LIST_ENVIRONMENT}[${env_id}].demandware.net
  ${DYOURL}=  Catenate  ${URLCred}/s/@{ENV_LOCALE_SUFFIX}[${env_id}]/${UK_PRODUCT_ID}.html?metricId=${UK_METRICID}
  [Return]  ${DYOURL}

Set US DYO URL
  ${URLCred}=  Catenate  http://@{LIST_ENVIRONMENT}[${env_id}].demandware.net
  ${DYOURL} =  Catenate  ${URLCred}/${US_PRODUCT_ID}.html?metricId=${US_METRICID}&enableHTMLBuilder=true
  [Return]  ${DYOURL}

Start DYO Checkout
  [Arguments]  ${name}=${validSite_name}  ${lastName}=${validSite_lastName}  ${address1}=${DEFAULTADDRESS}  ${city}=${DEFAULTCITY}  ${state}=${DEFAULTSTATE}  ${zipcode}=${DEFAULTZIPCODE}
  ...  ${phone}=${DEFAULTPHONE}  ${email}=${validSite_user}  ${nameOnCard}=${validSite_name} ${validSite_lastName}  ${cardType}=${DEFAULTTYPECC}  ${cardNumber}=${DEFAULTCC}  ${exp_Month}=${DEFAULTEXPMONTH}
  ...  ${exp_Year}=${DEFAULTEXPYEAR}  ${secCode}=${DEFAULTSECCODE}  ${PageMessage}=Complete Your Purchase
  Add DYO To Cart
  Open Cart
  Click Checkout Button from Cart
  Continue checkout with Credit Card
  Run Keyword If  '@{ENV_TYPE}[${env_id}]'!='production'  Click at Submit Order and Verifies Retrieves Message
