*** Settings ***
Resource        checkout_definitions.txt
Resource        common_keywords.txt
Library         Selenium2Library
Library         String
Library         Screenshot

*** Variables ***
${AMOUNT_RIGTH}  //div[@id='main']/div[@id='secondary']/div[@class='checkout-sidebar-inner']/div[@class='checkout-order-totals']/div[@class='order-totals-container']/div[
${AMOUNT_END}   ]/span[@class='price']
${ORDER_SALES_TAX}  @class='order-row order-sales-tax'
${DISCOUNT_APPLIED}  //div[@id='secondary']//span[contains(text(),'Discount')]
${NOTAXES}      Calculated upon shipment

*** Keywords ***
Verify Taxes in Checkout Page
  [Arguments]  ${city}  ${state}  ${zipcode}  ${tax}  ${long}=0  ${qty}=1
  Start Checkout with Specific Qty  ${qty}
  Run Keyword If  '${long}'=='0'  Fill Shipping Standard  ${validSite_name}  ${validSite_lastName}  ${DEFAULTADDRESS}  ${city}
  ...  ${state}  ${zipcode}  ELSE  Continue checkout with Credit Card  ${validSite_name}  ${validSite_lastName}
  ...  ${DEFAULTADDRESS}  ${city}  ${state}  ${zipcode}
  ${passed}=  Run Keyword And Return Status  Page Should Not Contain Element  ${DISCOUNT_APPLIED}
  Run Keyword If  ${passed}  Page Should Not Contain  ${NOTAXES}
  Continue TAX Test  ${tax}  ${city}

Continue TAX Test
  [Arguments]  ${tax}  ${city}
  ${taxValue} =  Get Text Value  ${AMOUNT_RIGTH}${ORDER_SALES_TAX}${AMOUNT_END}
  Run Keyword If  '$${tax}'!='${taxValue}'  Warning Tax Difference  ${tax}  ${taxValue}  ${city}  ELSE
  ...  Should Be Equal  $${tax}  ${taxValue}

Warning Tax Difference
  [Arguments]  ${tax}  ${taxValue}  ${city}
  Log  Difference detected, Expected:$${tax}; Retrieved:${taxValue}, for: ${city}  WARN
