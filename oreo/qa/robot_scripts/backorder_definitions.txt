*** Settings ***
Library         Selenium2Library
Resource        demandware_configuration_definitions.txt
Resource        pdp_declarations.txt
Resource        site_declarations.txt
Resource        cart_definitions.txt

*** Variables ***
${INSTOCKMSG}   Item(s) In Stock')]
${BACKORDMSG}   item(s) expected to ship on')]
${not_available}  //span[@class='not-available-msg red']
${instocklocator}  //span[@class='in-stock-msg'][contains(text(), '
${backorderlocator}  //span[@class='backorder-msg red'][contains(text(), '

*** Keywords ***
Setting Up Backorder Items in Demandware
  [Arguments]  ${productId}  ${allocation}  ${inStockDate}  ${backOrderAllocation}
  Open Demandware
  Set Inventory for Product  ${productId}_${InlineSize}  ${allocation}  ${inStockDate}  ${backOrderAllocation}
  Close All Browsers
  Open Browser to Converse Site

Verify Backorder Messaging
  [Arguments]  ${backorderType}  ${keyword}  ${productId}  ${allocation}  ${backOrderAllocation}
  Setting Up Backorder Items in Demandware  ${productId}  ${allocation}  ${inStockDate}  ${backOrderAllocation}
  ${thirdnumInt} =  Evaluate  ${allocation}-1
  ${inbackorderInt}=  Evaluate  ${allocation}+${backOrderAllocation}-1
  ${fifthnumInt} =  Evaluate  ${allocation}+${backOrderAllocation}+2
  ${instock-1} =  Convert To String  ${thirdnumInt}
  ${inbackorder}=  Convert To String  ${inbackorderInt}
  ${outbackorder} =  Convert To String  ${fifthnumInt}
  Search Specific Product  ${productId}
  Select Product Size
  Verify Correct Stock Messages for  ${backorderType}  ${keyword}  ${allocation}  ${instock-1}  ${inbackorder}  ${outbackorder}
  ...  ${backorderAllocation}

Verify Correct Stock Messages for
  [Arguments]  ${backorderType}  ${keyword}  ${allocation}  ${instock-1}  ${inbackorder}  ${outbackorder}
  ...  ${backorder}
  Run Keyword  ${backorderType}
  Verify inStock Message  ${keyword}  ${instock-1}
  Verify inStock Message  ${keyword}  ${allocation}
  Verify outStock Message  ${keyword}  ${inbackorder}  ${allocation}
  Verify outStock and Outbackorder message  ${keyword}  ${outbackorder}  ${allocation}  ${backorder}
  Run Keyword  ${keyword}  1

Verify Backorder from Cart
  Set a Product Number  1
  Add a Product to Cart
  Open Cart
  Log  Verifying Backorder in Cart's Page

Verify Backorder from PDP
  Log  Verifying Backorder in PDP Page

Verify inStock Message
  [Arguments]  ${keyword}  ${productNumber}
  Run Keyword  ${keyword}  ${productNumber}
  Sleep  1
  Page Should Not Contain Element  ${not_available}

Verify Backorder Message
  [Arguments]  ${keyword}  ${inbackorder}
  Run Keyword  ${keyword}  ${inbackorder}
  Sleep  1
  Wait Until Page Contains Element  ${backorderlocator} ${BACKORDMSG}

Verify outStock Message
  [Arguments]  ${keyword}  ${inbackorder}  ${allocation}
  Run Keyword  ${keyword}  ${inbackorder}
  Sleep  1
  Wait Until Page Contains Element  ${instocklocator}${allocation} ${INSTOCKMSG}
  Wait Until Page Contains Element  ${backorderlocator} ${BACKORDMSG}

Verify outStock and Outbackorder message
  [Arguments]  ${keyword}  ${outbackorder}  ${allocation}  ${backorder}
  Run Keyword  ${keyword}  ${outbackorder}
  Sleep  1
  Wait Until Page Contains Element  ${instocklocator}${allocation} ${INSTOCKMSG}
  Wait Until Page Contains Element  ${backorderlocator}${backorder} ${BACKORDMSG}
