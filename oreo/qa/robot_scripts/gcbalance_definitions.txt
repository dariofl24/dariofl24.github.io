*** Settings ***
Library         Selenium2Library
Library         String
Resource        gc_definitions.txt

*** Variables ***
${I_GCNUMBER}   dwfrm_giftcard_balance_cardnumber
${I_GCPIN}      dwfrm_giftcard_balance_pin
${A_APPLY}      checkbalancebtn
${U_GCLANDING}  /default/GiftCard-Purchase
${S_BALANCEVALUE}  balancevalue
${L_GIFTCARDPAGE}  //a[@title='Gift Cards']
${T_GIFCARDTITLE}  //div[@id='main-title']/h1[contains( text(),'Gift Cards')]
${T_BGC}        checkgc-view
${T_EGF}        Enter Your Gift Card Number and PIN Below
${ERROR_LINE}   //div[@class='error-line'][contains(text(),'
${FIELD_MESSAGE}  //div[@class='message-placeholder']/ul/li[contains(text(),'

*** Keywords ***
Go To Gift Card Landing Page
  Open Browser to Converse Site
  Wait Until Page Contains Element  ${L_FOOTER}${L_GIFTCARDPAGE}
  Click Element  ${L_FOOTER}${L_GIFTCARDPAGE}
  Wait Until Page Contains  ${M_BGC}

Fill Gift Card Data
  [Arguments]  ${gcnumber}=${valid_gc_number}  ${gcpin}=${valid_gc_pin}
  Wait Until Page Contains Element  ${I_GCNUMBER}
  Input Text  ${I_GCNUMBER}  ${gcnumber}
  Input Text  ${I_GCPIN}  ${gcpin}

Submit Gift Card Data
  [Arguments]  ${expected}  ${type}
  Click Element  ${A_APPLY}
  Sleep  1
  Run Keyword If  '${type}'=='FIELDERROR'  Wait Until Page Contains Element  ${FIELD_MESSAGE}${expected}')]
  Run Keyword If  '${type}'=='TOPMESSAGE'  Wait Until Page Contains Element  ${ERROR_LINE}${expected}')]

Check Gift Card Balance and its validations
  [Arguments]  ${gcnumber}  ${gcpin}  ${expected}  ${type}  ${validatequantity}
  #Go to Specific Gift Card Page  ${T_BGC}  ${T_EGF}
  Fill Gift Card Data  ${gcnumber}  ${gcpin}
  Submit Gift Card Data  ${expected}  ${type}
  Run Keyword If  '${validatequantity}'=='true'  Check GC Balance is > 0

Click on Apply Data
  Click Element  ${A_APPLY}

Check GC Balance is > 0
  ${balanceString} =  Get Text Value  ${S_BALANCEVALUE}
  ${balanceString} =  Fetch From Right  ${balanceString}  $
  ${balanceValue} =  Convert To Number  ${balanceString}
  Run Keyword If  ${balanceValue} <= 0  No Positive Balance

No Positive Balance
  Fail  'The balance of the given gift card is not positive, checkout can't be executed please review the valid GC code and PIN provided in common.txt file'  beforeRGA
